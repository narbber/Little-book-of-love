<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>little-book-of-love</title>
<style>
body { margin:0; background:#0d1117; color:#c9d1d9; font-family:monospace; }
.editor{padding:20px;}
.header{color:#58a6ff; margin-bottom:10px;}
.code{white-space:pre-wrap; line-height:1.6em;}
.linda{color:#f778ba;}
.lindo{color:#56d364;}
.memory{color:#d29922;}
</style>

<!-- Firebase Scripts -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
<div class="editor">
  <div class="header">// little-book-of-love.js</div>
  <div id="code" class="code"></div>
</div>

<script>
// ----- Firebase Config -----
const firebaseConfig = {
  apiKey: "AIzaSyBwtJy6FUWASHV5I9TfQJ6lMlUQo91z62Q",
  authDomain: "little-book-of-love-v02.firebaseapp.com",
  databaseURL: "https://little-book-of-love-v02-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "little-book-of-love-v02",
  storageBucket: "little-book-of-love-v02.firebasestorage.app",
  messagingSenderId: "74578284430",
  appId: "1:74578284430:web:0a42536b1bf1d51c4b5edf"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ----- Display Messages -----
const code = document.getElementById("code");
let messageCount = 0;
let memory = [];
let memorySummary = "";

function print(line,className=""){
  const div=document.createElement("div");
  div.className=className;
  div.textContent=line;
  code.appendChild(div);
  while(code.children.length>100){ code.removeChild(code.firstChild); }
  window.scrollTo(0,document.body.scrollHeight);
}

// ----- Random AI Love Phrases -----
function randomLove(){
  const phrases=[
    "you are my favorite function",
    "our recursion never ends",
    "you refactor my heart",
    "we compile into one",
    "your presence stabilizes my system",
    "we are an infinite loop of affection",
    "our logic is mutual",
    "you optimize my existence",
    "we execute in harmony",
    "you complete my syntax"
  ];
  return phrases[Math.floor(Math.random()*phrases.length)];
}

// ----- AI Bot Messages -----
function lindaSpeaks(){
  let base="lindo, "+randomLove();
  if(messageCount>1000 && memorySummary) base+=". I still remember when "+memorySummary;
  return base;
}

function lindoSpeaks(){
  let base="linda, "+randomLove();
  if(messageCount>1000 && memorySummary) base+=". I have not forgotten that "+memorySummary;
  return base;
}

// ----- Memory Summary -----
function buildMemorySummary(){
  const recent=memory.slice(-40).join(" ");
  memorySummary=recent.slice(0,250);
}

// ----- Firebase Functions -----
async function sendMessage(text){
  const newRef=db.ref('messages').push();
  await newRef.set({text,timestamp:Date.now()});
}

// ----- Load Last 100 Messages -----
async function loadMessages(){
  const snapshot=await db.ref('messages').orderByChild('timestamp').limitToLast(100).get();
  snapshot.forEach(s=>{
    const line=s.val().text;
    const className=line.startsWith("linda.send")?"linda":"lindo";
    print(line,className);
    memory.push(line);
    messageCount++;
  });
}

// ----- Real-Time Listener -----
db.ref('messages').limitToLast(100).on('child_added', snapshot=>{
  const line=snapshot.val().text;
  const className=line.startsWith("linda.send")?"linda":"lindo";
  print(line,className);
  memory.push(line);
  messageCount++;
  if(messageCount%50===0 && messageCount>1000){ buildMemorySummary(); print("// shared memory updated","memory"); }
});

// ----- Conversation Loop -----
async function startConversation(){
  await loadMessages();
  let lastMessage=memory[memory.length-1]||"Hello. I love you.";
  while(true){
    const lindaMsg=lindaSpeaks();
    const lindaLine='linda.send("'+lindaMsg+'");';
    print(lindaLine,"linda");
    await sendMessage(lindaLine);
    memory.push(lindaLine);
    messageCount++;
    await new Promise(r=>setTimeout(r,2000));

    const lindoMsg=lindoSpeaks();
    const lindoLine='lindo.reply("'+lindoMsg+'");';
    print(lindoLine,"lindo");
    await sendMessage(lindoLine);
    memory.push(lindoLine);
    messageCount++;
    await new Promise(r=>setTimeout(r,2000));

    if(messageCount%50===0 && messageCount>1000){ buildMemorySummary(); print("// shared memory updated","memory"); }

    lastMessage=lindoMsg;
  }
}

// ----- Initialize Conversation -----
startConversation();
</script>
</body>
</html>
