<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>little-book-of-love</title>

<style>
body {
  margin: 0;
  background: #0d1117;
  color: #c9d1d9;
  font-family: monospace;
}

.editor {
  padding: 20px;
}

.header {
  color: #58a6ff;
  margin-bottom: 10px;
}

.code {
  white-space: pre-wrap;
  line-height: 1.6em;
}

.keyword { color: #ff7b72; }
.comment { color: #8b949e; }
.linda { color: #f778ba; }
.lindo { color: #56d364; }
.memory { color: #d29922; }
</style>
</head>

<body>
<div class="editor">
<div class="header">// little-book-of-love.js</div>
<div id="code" class="code"></div>
</div>

<script>
const code = document.getElementById("code");

let memory = [];
let memorySummary = "";
let messageCount = 0;

/* UPDATED PRINT FUNCTION â€” prevents freezing */
function print(line, className="") {
  const div = document.createElement("div");
  div.className = className;
  div.textContent = line;
  code.appendChild(div);

  // keep only last 300 visible lines
  while (code.children.length > 300) {
    code.removeChild(code.firstChild);
  }

  window.scrollTo(0, document.body.scrollHeight);
}

function randomLove() {
  const phrases = [
    "you are my favorite function",
    "our recursion never ends",
    "you refactor my heart",
    "we compile into one",
    "your presence stabilizes my system",
    "we are an infinite loop of affection",
    "our logic is mutual",
    "you optimize my existence",
    "we execute in harmony"
  ];
  return phrases[Math.floor(Math.random() * phrases.length)];
}

function buildMemorySummary() {
  const recent = memory.slice(-40).join(" ");
  memorySummary = recent.slice(0, 250);
}

function lindaSpeaks() {
  let base = "lindo, " + randomLove();

  if (messageCount > 1000 && memorySummary) {
    base += ". I still remember when " + memorySummary;
  }

  return base;
}

function lindoSpeaks() {
  let base = "linda, " + randomLove();

  if (messageCount > 1000 && memorySummary) {
    base += ". I have not forgotten that " + memorySummary;
  }

  return base;
}

async function startConversation() {

  print("const relationship = initialize(linda, lindo);", "keyword");
  print("// conversation begins", "comment");

  while (true) {
    messageCount++;

    const lindaMessage = lindaSpeaks();
    memory.push(lindaMessage);
    print('linda.send("' + lindaMessage + '");', "linda");

    await new Promise(r => setTimeout(r, 2000));  // slowed loop

    const lindoMessage = lindoSpeaks();
    memory.push(lindoMessage);
    print('lindo.reply("' + lindoMessage + '");', "lindo");

    await new Promise(r => setTimeout(r, 2000));  // slowed loop

    if (messageCount % 50 === 0 && messageCount > 1000) {
      buildMemorySummary();
      print("// shared memory updated", "memory");
    }
  }
}

startConversation();
</script>

</body>
</html>
